var wxApp = angular.module('wxApp', [ 'ngRoute', 'ngAnimate' ]);

wxApp.config(["$routeProvider", function(routeProvider) {
	routeProvider.when("/:tpl", {
		templateUrl : function(routeProvider) {
			return routeProvider.tpl + ".jspx"
		}
	}).otherwise({
		redirectTo : "/home"
	})
} ]);

wxApp.controller('wxCtrl', ['$rootScope', '$scope', '$filter', '$location', '$timeout', function($rootScope, $scope, $filter, $location, $timeout) {
	
	$scope.title = '热泵在线';
	
	var changeSelectedTabWithTitle = function(path, title) {
		var path = path || $location.path().replace('\/', '') || 'home';
		switch (path) {
			case 'home':
				$scope.title = title || '热泵在线 - 首页';$scope.currentTab = path;break;
			case 'pump':
				$scope.title = title || '热泵在线 - 热泵';$scope.currentTab = path;break;
			case 'warn':
				$scope.title = title || '热泵在线 - 告警';$scope.currentTab = path;break;
			case 'user':
				$scope.title = title || '热泵在线 - 我的';$scope.currentTab = path;break;
			case 'about':
				$scope.title = title || '热泵在线 - 关于';break;
			case 'update_pwd':
				$scope.title = title || '热泵在线 - 修改密码';break;
			case 'update_user_info':
				$scope.title = title || '热泵在线 - 修改个人信息';break;
			case 'pump-console':
				$scope.title = title || '热泵在线 - 热泵监控';break;
			default:
				$scope.title = '热泵在线 - 首页';
		}
	}
	
	$scope.currentTab = 'home';
	changeSelectedTabWithTitle();

	$scope.gotoUrl = function(path, title) {
		$location.path(path);
		changeSelectedTabWithTitle(path, title);
	}

	$scope.goBack = function() {
		window.history.back()
	}
	
    $rootScope.$on('$routeChangeSuccess',function(){
    	var currentPath = $location.path().replace('\/', '');
    	switch(currentPath) {
	    	case 'home':loadPumpGcEchartData();break;
			case 'pump-console':loadPumpEchartData();break;
    	}
    });

	$scope.pumpConsole = function(pumpId, pumpName){
		$scope.currentPumpId = pumpId;
		$scope.gotoUrl('pump-console', pumpName);
	}
	
	$scope.switchConsoleTab = function(type) {
		$('.' + type).addClass('weui-bar__item_on').siblings('.weui-bar__item_on').removeClass('weui-bar__item_on');
		$('#' + type).removeClass('hide').siblings().addClass('hide');
	}
	
	function loadPumpEchartData(){
		$timeout(function(){
			var myChart = echarts.init(document.getElementById('c_h_chart'));
			var option = {
			    tooltip: {
			        trigger: 'axis',
			        formatter: function(params){
			        	var res = $filter('date')(params[0].axisValue,'HH:mm');
			            for (var i = 0, l = params.length; i < l; i++) {
			                res += '<br/>' + params[i].seriesName + ' : ' + params[i].data[1];
			            }
			            return res;
			        }
			    },
			    legend: {
			        data:['环境温度','室内温度','水箱温度','出水温度','回水温度','排气温度','回气温度','压缩机电流']
			    },
			    grid: {
			        x: 10,
			        y: 70,
			        x2: 30,
			        y2: 2,
			        containLabel: true
			    },
			    xAxis: {
			        type: 'time',
			        position: 'bottom',
			        boundaryGap: true,
			        min: new Date(2014, 9, 1, 0, 0),
			        max: new Date(2014, 9, 23, 59, 59),
			        axisLabel: {
			        	formatter : function (value) {
				        	$filter('date')(value,'HH:mm');
				        }
			        }
			    },
			    yAxis: [{
			        type: 'value',
			        position: 'left',
			        boundaryGap: [0, 0.1],
			        axisLabel: {
			            formatter: function(value) {
			                return value + ' ℃'
			            }
			        },
			        splitLine: {
			            show: true,
			            lineStyle: {
			                color: 'gray',
			                type: 'dotted',
			                width: 1
			            }
			        }
			    },{
			        type: 'value',
			        axisLabel: {
			            formatter: function(value) {
			                return value + ' A'
			            }
			        }
			    }],
			    series: [
			        {
			            name:'环境温度',
			            type:'line',
			            yAxisIndex: 0,
			            smooth: true,
			            data:[[new Date(2014, 9, 1, 2, 1),120], [new Date(2014, 9, 1, 3, 2),132], [new Date(2014, 9, 1, 5, 3),101], [new Date(2014, 9, 1, 6, 4),134], [new Date(2014, 9, 1, 7, 5),90], [new Date(2014, 9, 1, 8, 6),230], [new Date(2014, 9, 1, 9, 10),210]]
			        },
			        {
			            name:'室内温度',
			            type:'line',
			            yAxisIndex: 0,
			            smooth: true,
			            data:[[new Date(2014, 9, 1, 2, 1),120], [new Date(2014, 9, 1, 3, 2),132], [new Date(2014, 9, 1, 5, 3),101], [new Date(2014, 9, 1, 6, 4),134], [new Date(2014, 9, 1, 7, 5),90], [new Date(2014, 9, 1, 8, 6),230], [new Date(2014, 9, 1, 9, 10),210]]
			        },
			        {
			            name:'水箱温度',
			            type:'line',
			            yAxisIndex: 0,
			            smooth: true,
			            data:[[new Date(2014, 9, 1, 2, 1),120], [new Date(2014, 9, 1, 3, 2),132], [new Date(2014, 9, 1, 5, 3),101], [new Date(2014, 9, 1, 6, 4),134], [new Date(2014, 9, 1, 7, 5),90], [new Date(2014, 9, 1, 8, 6),230], [new Date(2014, 9, 1, 9, 10),210]]
			        },
			        {
			            name:'出水温度',
			            type:'line',
			            yAxisIndex: 0,
			            smooth: true,
			            data:[[new Date(2014, 9, 1, 2, 1),120], [new Date(2014, 9, 1, 3, 2),132], [new Date(2014, 9, 1, 5, 3),101], [new Date(2014, 9, 1, 6, 4),134], [new Date(2014, 9, 1, 7, 5),90], [new Date(2014, 9, 1, 8, 6),230], [new Date(2014, 9, 1, 9, 10),210]]
			        },
			        {
			            name:'回水温度',
			            type:'line',
			            yAxisIndex: 0,
			            smooth: true,
			            data:[[new Date(2014, 9, 1, 2, 1),120], [new Date(2014, 9, 1, 3, 2),132], [new Date(2014, 9, 1, 5, 3),101], [new Date(2014, 9, 1, 6, 4),134], [new Date(2014, 9, 1, 7, 5),90], [new Date(2014, 9, 1, 8, 6),230], [new Date(2014, 9, 1, 9, 10),210]]
			        },
			        {
			            name:'排气温度',
			            type:'line',
			            yAxisIndex: 0,
			            smooth: true,
			            data:[[new Date(2014, 9, 1, 2, 1),120], [new Date(2014, 9, 1, 3, 2),132], [new Date(2014, 9, 1, 5, 3),101], [new Date(2014, 9, 1, 6, 4),134], [new Date(2014, 9, 1, 7, 5),90], [new Date(2014, 9, 1, 8, 6),230], [new Date(2014, 9, 1, 9, 10),210]]
			        },
			        {
			            name:'回气温度',
			            type:'line',
			            yAxisIndex: 0,
			            smooth: true,
			            data:[[new Date(2014, 9, 1, 2, 1),120], [new Date(2014, 9, 1, 3, 2),132], [new Date(2014, 9, 1, 5, 3),101], [new Date(2014, 9, 1, 6, 4),134], [new Date(2014, 9, 1, 7, 5),90], [new Date(2014, 9, 1, 8, 6),230], [new Date(2014, 9, 1, 9, 10),210]]
			        },
			        {
			            name:'压缩机电流',
			            type:'line',
			            yAxisIndex: 1,
			            smooth: true,
			            data:[[new Date(2014, 9, 1, 2, 1),120], [new Date(2014, 9, 1, 3, 2),132], [new Date(2014, 9, 1, 5, 3),101], [new Date(2014, 9, 1, 6, 4),134], [new Date(2014, 9, 1, 7, 5),90], [new Date(2014, 9, 1, 8, 6),230], [new Date(2014, 9, 1, 9, 10),210]]
			        }
			    ]
			};
			myChart.setOption(option);
			$timeout(function(){
				$('#c_base').siblings().addClass('hide');
			})
		}, 100);
	}
	
	function loadPumpGcEchartData(){
		$timeout(function(){
			var myChart = echarts.init(document.getElementById('all_gc_chart'));
			var option = {
			    tooltip: {
			        trigger: 'axis'
			    },
			    grid: {
			        x: 10,
			        y: 10,
			        x2: 30,
			        y2: 10,
			        containLabel: true
			    },
			    xAxis: {
			        type: 'category',
			        boundaryGap: false,
			        data: ['00:05','00:10','00:15','00:20','00:25','00:30','00:35']
			    },
			    yAxis: {
			        type: 'value'
			    },
			    series: [
			        {
			            name:'用电量',
			            type:'line',
			            smooth: true,
			            data:[120, 132, 101, 134, 90, 230, 210]
			        }
			    ]
			};
			myChart.setOption(option);
		}, 100);
	}
}]);